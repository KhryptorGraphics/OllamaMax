# HAProxy Configuration for Redis Cluster Connection Pooling
global
    maxconn 4096
    user haproxy
    group haproxy
    daemon

defaults
    mode tcp
    timeout connect 5s
    timeout client 30s
    timeout server 30s
    option tcplog
    retries 3

# Redis Cluster Frontend
frontend redis_cluster_frontend
    bind *:6399
    default_backend redis_cluster_backend

# Redis Cluster Backend with Load Balancing
backend redis_cluster_backend
    balance roundrobin
    option tcp-check
    tcp-check send PING\r\n
    tcp-check expect string +PONG
    
    server redis-node-1 172.25.0.11:6379 check inter 5s rise 2 fall 3 weight 100
    server redis-node-2 172.25.0.12:6379 check inter 5s rise 2 fall 3 weight 100
    server redis-node-3 172.25.0.13:6379 check inter 5s rise 2 fall 3 weight 100

# Stats Interface
frontend stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 30s
    stats admin if TRUE