# Production Configuration for OllamaMax Distributed
# This configuration is optimized for production deployment

node:
  id: "${OLLAMA_NODE_ID}"
  name: "${OLLAMA_NODE_NAME}"
  region: "${OLLAMA_NODE_REGION}"
  zone: "${OLLAMA_NODE_ZONE}"
  environment: "production"
  tags:
    cluster: "${OLLAMA_CLUSTER_NAME}"
    version: "${OLLAMA_VERSION}"

api:
  listen: "0.0.0.0:8080"
  timeout: "60s"
  max_body_size: 536870912  # 512MB
  tls:
    enabled: true
    cert_file: "/etc/ssl/certs/ollama.crt"
    key_file: "/etc/ssl/private/ollama.key"
  cors:
    enabled: true
    allowed_origins: ["https://*.yourdomain.com"]
    allowed_methods: ["GET", "POST", "PUT", "DELETE"]
    allowed_headers: ["Authorization", "Content-Type"]
  rate_limit:
    enabled: true
    requests_per_minute: 1000
    burst: 100

p2p:
  enabled: true
  listen: "0.0.0.0:9000"
  bootstrap_peers: "${OLLAMA_BOOTSTRAP_PEERS}"
  discovery:
    enabled: true
    mdns_enabled: false  # Disabled in production
    dht_enabled: true
    rendezvous: "ollama-distributed-v1"
  nat:
    enabled: true
    upnp_enabled: false  # Disabled in production
    turn_servers:
      - address: "${TURN_SERVER_1}"
        username: "${TURN_USERNAME}"
        password: "${TURN_PASSWORD}"

consensus:
  enabled: true
  data_dir: "/var/lib/ollama/consensus"
  election_timeout: "5s"
  heartbeat_timeout: "2s"
  snapshot_interval: 10000
  snapshot_threshold: 100000

scheduler:
  enabled: true
  algorithm: "weighted_round_robin"
  max_concurrent_tasks: 100
  task_timeout: "30m"
  health_check_interval: "30s"

storage:
  data_dir: "/var/lib/ollama"
  model_dir: "/var/lib/ollama/models"
  cache_dir: "/var/cache/ollama"
  max_cache_size: 107374182400  # 100GB

security:
  auth:
    enabled: true
    method: "jwt"
    secret_key: "${OLLAMA_JWT_SECRET}"
    token_expiry: "1h"
  tls:
    enabled: true
    cert_file: "/etc/ssl/certs/ollama.crt"
    key_file: "/etc/ssl/private/ollama.key"
  encryption:
    enabled: true
    algorithm: "aes-256-gcm"

web:
  enabled: true
  listen: "0.0.0.0:8081"
  static_dir: "/usr/share/ollama/web/static"
  template_dir: "/usr/share/ollama/web/templates"

metrics:
  enabled: true
  listen: "127.0.0.1:9090"  # Internal only
  path: "/metrics"
  interval: "30s"

logging:
  level: "info"
  format: "json"
  output: "file"
  file: "/var/log/ollama/ollama.log"

sync:
  enabled: true
  interval: "5m"
  batch_size: 1000
  delta_dir: "/var/lib/ollama/deltas"
  cas_dir: "/var/lib/ollama/cas"

replication:
  enabled: true
  factor: 3  # Triple replication for production
  strategy: "geographic"
  health_check_interval: "1m"

distributed:
  enabled: true
  cluster_id: "${OLLAMA_CLUSTER_ID}"
  cas_dir: "/var/lib/ollama/distributed/cas"
  delta_dir: "/var/lib/ollama/distributed/deltas"
  sync_interval: "5m"
  max_chunk_size: 10485760  # 10MB
